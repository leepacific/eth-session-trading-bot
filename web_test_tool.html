<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 API 테스트 도구</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .results {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #95a5a6;
        }
        
        .result-success {
            background: #d5f4e6;
            border-left-color: #27ae60;
        }
        
        .result-error {
            background: #fadbd8;
            border-left-color: #e74c3c;
        }
        
        .result-warning {
            background: #fef9e7;
            border-left-color: #f39c12;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧪 API 테스트 도구</h1>
            <p>트레이딩 봇 API 상태 및 보안 테스트</p>
        </div>
        
        <div class="content">
            <!-- API URL 설정 -->
            <div class="test-section">
                <h3>🌐 API 설정</h3>
                <div class="input-group">
                    <label for="apiUrl">API URL:</label>
                    <input type="text" id="apiUrl" placeholder="https://api.your-domain.com" 
                           value="https://api.eth-trading-bot.com">
                </div>
                <button class="btn" onclick="testConnection()">연결 테스트</button>
            </div>
            
            <!-- 기본 기능 테스트 -->
            <div class="test-section">
                <h3>🔍 기본 기능 테스트</h3>
                <button class="btn" onclick="testHealth()">헬스체크</button>
                <button class="btn" onclick="testStatus()">상태 확인</button>
                <button class="btn" onclick="testNotFound()">404 테스트</button>
                <button class="btn btn-success" onclick="runAllBasicTests()">전체 기본 테스트</button>
            </div>
            
            <!-- Rate Limiting 테스트 -->
            <div class="test-section">
                <h3>⚡ Rate Limiting 테스트</h3>
                <div class="input-group">
                    <label for="requestCount">요청 수:</label>
                    <input type="number" id="requestCount" value="20" min="1" max="100">
                </div>
                <button class="btn btn-danger" onclick="testRateLimit()">Rate Limit 테스트</button>
                <p style="margin-top: 10px; color: #7f8c8d; font-size: 0.9em;">
                    ⚠️ 이 테스트는 서버에 부하를 줄 수 있습니다.
                </p>
            </div>
            
            <!-- 보안 테스트 -->
            <div class="test-section">
                <h3>🛡️ 보안 테스트</h3>
                <button class="btn" onclick="testSecurity()">보안 헤더 확인</button>
                <button class="btn" onclick="testSSL()">SSL 인증서 확인</button>
                <button class="btn" onclick="testCloudflare()">Cloudflare 확인</button>
            </div>
            
            <!-- 성능 테스트 -->
            <div class="test-section">
                <h3>⚡ 성능 테스트</h3>
                <button class="btn" onclick="testPerformance()">응답 시간 측정</button>
                <button class="btn" onclick="testThroughput()">처리량 테스트</button>
            </div>
            
            <!-- 로딩 표시 -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>테스트 실행 중...</p>
            </div>
            
            <!-- 결과 표시 -->
            <div class="results" id="results" style="display: none;">
                <h3>📊 테스트 결과</h3>
                <div id="resultContent"></div>
                
                <!-- 통계 -->
                <div class="stats" id="stats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-number" id="successCount">0</div>
                        <div class="stat-label">성공한 테스트</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="failCount">0</div>
                        <div class="stat-label">실패한 테스트</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgResponseTime">0ms</div>
                        <div class="stat-label">평균 응답시간</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTests">0</div>
                        <div class="stat-label">총 테스트 수</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        let responseTimes = [];

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
        }

        function addResult(test, success, message, responseTime = null) {
            const result = {
                test,
                success,
                message,
                responseTime,
                timestamp: new Date().toLocaleTimeString()
            };
            
            testResults.push(result);
            if (responseTime) responseTimes.push(responseTime);
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `result-item ${success ? 'result-success' : 'result-error'}`;
            
            let content = `
                <strong>${success ? '✅' : '❌'} ${test}</strong><br>
                ${message}<br>
                <small>시간: ${result.timestamp}</small>
            `;
            
            if (responseTime) {
                content += `<br><small>응답시간: ${responseTime}ms</small>`;
            }
            
            resultDiv.innerHTML = content;
            document.getElementById('resultContent').appendChild(resultDiv);
            
            updateStats();
        }

        function updateStats() {
            const successCount = testResults.filter(r => r.success).length;
            const failCount = testResults.filter(r => !r.success).length;
            const avgResponseTime = responseTimes.length > 0 
                ? Math.round(responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length)
                : 0;
            
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('failCount').textContent = failCount;
            document.getElementById('avgResponseTime').textContent = avgResponseTime + 'ms';
            document.getElementById('totalTests').textContent = testResults.length;
            document.getElementById('stats').style.display = 'grid';
        }

        function clearResults() {
            testResults = [];
            responseTimes = [];
            document.getElementById('resultContent').innerHTML = '';
            document.getElementById('stats').style.display = 'none';
        }

        async function makeRequest(endpoint, method = 'GET') {
            const baseUrl = document.getElementById('apiUrl').value.replace(/\/$/, '');
            const url = baseUrl + endpoint;
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, {
                    method: method,
                    mode: 'cors'
                });
                
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                let responseData = null;
                try {
                    responseData = await response.json();
                } catch (e) {
                    responseData = await response.text();
                }
                
                return {
                    success: true,
                    status: response.status,
                    responseTime,
                    data: responseData,
                    headers: Object.fromEntries(response.headers.entries())
                };
            } catch (error) {
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                return {
                    success: false,
                    error: error.message,
                    responseTime
                };
            }
        }

        async function testConnection() {
            clearResults();
            showLoading();
            
            const result = await makeRequest('/health');
            
            if (result.success) {
                addResult('연결 테스트', true, `연결 성공 (${result.status})`, result.responseTime);
            } else {
                addResult('연결 테스트', false, `연결 실패: ${result.error}`, result.responseTime);
            }
            
            hideLoading();
        }

        async function testHealth() {
            const result = await makeRequest('/health');
            
            if (result.success && result.status === 200) {
                addResult('헬스체크', true, '헬스체크 정상', result.responseTime);
            } else {
                addResult('헬스체크', false, `헬스체크 실패 (${result.status || result.error})`, result.responseTime);
            }
        }

        async function testStatus() {
            const result = await makeRequest('/status');
            
            if (result.success && result.status === 200) {
                addResult('상태 확인', true, '상태 확인 정상', result.responseTime);
            } else {
                addResult('상태 확인', false, `상태 확인 실패 (${result.status || result.error})`, result.responseTime);
            }
        }

        async function testNotFound() {
            const result = await makeRequest('/nonexistent');
            
            if (result.success && result.status === 404) {
                addResult('404 테스트', true, '404 응답 정상', result.responseTime);
            } else {
                addResult('404 테스트', false, `예상과 다른 응답 (${result.status || result.error})`, result.responseTime);
            }
        }

        async function runAllBasicTests() {
            clearResults();
            showLoading();
            
            await testHealth();
            await testStatus();
            await testNotFound();
            
            hideLoading();
        }

        async function testRateLimit() {
            const requestCount = parseInt(document.getElementById('requestCount').value);
            
            clearResults();
            showLoading();
            
            addResult('Rate Limit 테스트', true, `${requestCount}개 요청 시작...`);
            
            const promises = [];
            for (let i = 0; i < requestCount; i++) {
                promises.push(makeRequest('/health'));
            }
            
            const results = await Promise.all(promises);
            
            const successCount = results.filter(r => r.success && r.status === 200).length;
            const rateLimitedCount = results.filter(r => r.success && r.status === 429).length;
            const errorCount = results.filter(r => !r.success).length;
            
            addResult('Rate Limit 결과', true, 
                `성공: ${successCount}, Rate Limited: ${rateLimitedCount}, 오류: ${errorCount}`);
            
            if (rateLimitedCount > 0) {
                addResult('Rate Limiting', true, 'Rate Limiting이 정상 작동 중');
            } else {
                addResult('Rate Limiting', false, 'Rate Limiting이 감지되지 않음');
            }
            
            hideLoading();
        }

        async function testSecurity() {
            const result = await makeRequest('/health');
            
            if (result.success) {
                const headers = result.headers;
                
                const securityChecks = {
                    'HTTPS': document.getElementById('apiUrl').value.startsWith('https://'),
                    'Cloudflare': headers.server && headers.server.toLowerCase().includes('cloudflare'),
                    'CF-Ray': !!headers['cf-ray'],
                    'Strict-Transport-Security': !!headers['strict-transport-security'],
                    'X-Frame-Options': !!headers['x-frame-options'],
                    'X-Content-Type-Options': !!headers['x-content-type-options']
                };
                
                for (const [check, passed] of Object.entries(securityChecks)) {
                    addResult(`보안: ${check}`, passed, passed ? '통과' : '미적용');
                }
            } else {
                addResult('보안 테스트', false, '보안 헤더 확인 실패');
            }
        }

        async function testSSL() {
            const url = document.getElementById('apiUrl').value;
            
            if (url.startsWith('https://')) {
                addResult('SSL 테스트', true, 'HTTPS 연결 확인됨');
            } else {
                addResult('SSL 테스트', false, 'HTTPS가 아닌 연결');
            }
        }

        async function testCloudflare() {
            const result = await makeRequest('/health');
            
            if (result.success) {
                const isCloudflare = result.headers['cf-ray'] || 
                                   (result.headers.server && result.headers.server.toLowerCase().includes('cloudflare'));
                
                if (isCloudflare) {
                    addResult('Cloudflare 테스트', true, 'Cloudflare 프록시 감지됨');
                } else {
                    addResult('Cloudflare 테스트', false, 'Cloudflare 프록시가 감지되지 않음');
                }
            } else {
                addResult('Cloudflare 테스트', false, 'Cloudflare 확인 실패');
            }
        }

        async function testPerformance() {
            clearResults();
            showLoading();
            
            const testCount = 10;
            addResult('성능 테스트', true, `${testCount}회 요청으로 성능 측정 시작...`);
            
            const times = [];
            
            for (let i = 0; i < testCount; i++) {
                const result = await makeRequest('/health');
                if (result.success) {
                    times.push(result.responseTime);
                }
            }
            
            if (times.length > 0) {
                const avgTime = Math.round(times.reduce((a, b) => a + b, 0) / times.length);
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                
                addResult('성능 결과', true, 
                    `평균: ${avgTime}ms, 최소: ${minTime}ms, 최대: ${maxTime}ms`);
                
                if (avgTime < 500) {
                    addResult('성능 평가', true, '우수한 성능');
                } else if (avgTime < 1000) {
                    addResult('성능 평가', true, '양호한 성능');
                } else {
                    addResult('성능 평가', false, '성능 개선 필요');
                }
            } else {
                addResult('성능 테스트', false, '성능 측정 실패');
            }
            
            hideLoading();
        }

        async function testThroughput() {
            clearResults();
            showLoading();
            
            const duration = 5000; // 5초
            const startTime = Date.now();
            let requestCount = 0;
            
            addResult('처리량 테스트', true, '5초간 처리량 측정 시작...');
            
            while (Date.now() - startTime < duration) {
                await makeRequest('/health');
                requestCount++;
            }
            
            const actualDuration = Date.now() - startTime;
            const throughput = Math.round((requestCount / actualDuration) * 1000);
            
            addResult('처리량 결과', true, `${requestCount}개 요청, ${throughput} req/s`);
            
            hideLoading();
        }
    </script>
</body>
</html>